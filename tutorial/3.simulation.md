Table of Contents
- [Overview](#overview)
- [Simulation Prepare](#simulation-prepare)
  - [Check usable features](#check-usable-features)
  - [Set cell density](#set-cell-density)
  - [Create a random mosiac](#create-a-random-mosiac)
  - [Interaction function](#interaction-function)
- [Simulation](#simulation)
- [Extention](#extention)

# Overview

```python
print(pattern)
```

```texture
Spatial pattern of Mouse Horizontal Cell, 
- Density: Unknown,
- Natural mosaics: 1 case(s),
- Simulated mosaics: total 30 case(s)
   0 case(s) in tag 'default',
   10 case(s) in tag 'O-PIPP',
   20 case(s) in tag 'PIPP',
- Features: 2
         Label  | Has target probabilities
         NN     | True
         VD     | True
         NNRI   | False
         VDRI   | False .
```

# Simulation Prepare

## Check usable features

```python
usable_features = pattern.get_usable_features()
# It is ["NN", "VD"]
```

## Set cell density

```python
density = pattern.estimate_density()
pattern.set_density(density=density)

pattern.set_density(87/90000.) # direct input the density
print(pattern)
```

```
Spatial pattern of Mouse Horizontal Cell, 
- Density: 0.0009667 (cells/unit^2),
- Natural mosaics: 1 case(s),
- Simulated mosaics: total 30 case(s)
   0 case(s) in tag 'default',
   10 case(s) in tag 'O-PIPP',
   20 case(s) in tag 'PIPP',
- Features: 4
         Label  | Has target probabilities
         NN     | True
         VD     | True
         NNRI   | False
         VDRI   | False .
```

## Create a random mosiac

```python
mosaic = pattern.new_mosaic(scope=scope)
mosaic.draw_points()

print(pattern.evaluate([mosaic], features=usable_features))
# 5.233049009275092
```
<p align="center">
<img src="imgs/sim-random.png" width="230">
<figcaption align = "center">Random points at initialization.</figcaption>
</p>

## Interaction function

```
h_func = pattern.get_interaction_func([7.5, 32.1206741, 2.64876305])
```

# Simulation

```python
from OPIPP import AdaptiveSchedule
mosaic, losses = pattern.simulate(mosaic=mosaic, interaction_func=h_func, features=None, schedule=AdaptiveSchedule(), save_prefix="examples/simulated/HC/Sample", save_step=500, verbose=True)

print(pattern.evaluate([mosaic], features=usable_features))
# 0.0288679366606423

mosaic.draw_points()
```

<p align="center">
<img src="imgs/sim-optimized.png" width="230">
<figcaption align = "center">Simulated mosaic after optimization.</figcaption>
</p>


```python
plt.plot(losses)
plt.show()
```

<p align="center">
<img src="imgs/sim-losses.png" width="230">
<figcaption align = "center">The trace of Entropy during optimization</figcaption>
</p>


load and saving

# Extention

- Spatial features

- Optimizaion Entropy

- Cooling Scedule